<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
    <link href="./todo.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div class="container bg-primary w-100 shadow ">
        <h2 class="text-light text-center p-5">Todo App</h2>
        <div class="d-flex justify-content-center align-items-center">
            <div class="input-group mt-5 d-flex justify-content-center align-items-center">
                <form class="d-flex justify-content-center align-items-center w-100">
                    <input type="text" class="form-control shadow w-75" placeholder="Add a todo" id="todo" name="todo"
                        required>
                    <input class="btn btn-dark shadow" type="submit" placeholder="Add">
                </form>
            </div>
        </div>
        <div class="d-flex justify-content-center align-items-center  p-5 ">
            <ul class="list-group w-75">
            </ul>
        </div>


        <div class="d-flex justify-content-evenly align-items-center p-5">
            <button class="btn btn-light" onclick="handleDeleteAll()">Delete all</button>
            <button class="btn btn-danger">completed</button>
        </div> 
    </div>

    <script>
        let formData = document.querySelector('form');
        let ls = localStorage.getItem('todo');
        let todo = ls ? JSON.parse(ls) : [];
        let idCount = 0;
        function getNewId() {
            return idCount = idCount + 1;
        }
        function getTodo () {
            let todoString = localStorage.getItem('todo');
            return JSON.parse(todoString);
        }
        function setTodo (todoList) {
            let tododata = JSON.stringify(todoList);
            localStorage.setItem('todo', tododata);
        }

        function renderTodos(todoList) {
            document.querySelector("ul").innerHTML = "";
            todoList.map((data, index) => {
            document.querySelector("ul").innerHTML += `<li value="${index}" class="list-group-item d-flex justify-content-between align-items-center w-100 shadow" id='li'>  
            
             <input class="form-check-input" type="checkbox" id="check-${index}" data-id="${index}"  onclick="handleCheckbox(this)" ${data.completed? "checked" :""}>
          <p class="${data.completed? "checked" : ""}">${index}.  ${data.name}</p>
          <div>
            <button class="btn btn-dark" onclick="handleDelete(${index})" >Delete</button>
            </div>
            </li>
        `
        })
        }
        formData.addEventListener('submit', (e) => {
            e.preventDefault();
            let inputData = formData[0].value;
            let todoList = getTodo();
            const todoObj ={
                id: getNewId(),
                name: inputData,
                completed: false
            }
            todoList.push(todoObj);
            setTodo(todoList);
            renderTodos(todoList);
        })

        function handleDelete(e) {
            let todoList = getTodo();
            let filteredList = todoList.filter((data, index) => {
                return index !== e;
            });
            setTodo(filteredList);
            renderTodos(filteredList);
        }

        function handleDeleteAll() {
            setTodo([]);
            renderTodos([]);
        }

        function handleCheckbox(element) {
            let itemPos = element.getAttribute("data-id")
            let isChecked = element.checked;
            console.log('isChecked: ', isChecked);
            console.log('itemPos: ', itemPos);
            let todoList = getTodo();
            let newTodoList = todoList.map((elem, index) => {
                if(index === parseInt(itemPos)){
                  let newElem = {
                    id: elem.id,
                    name: elem.name,
                    completed: isChecked
                  }
                  return newElem   
                } else {
                    return elem
                }
            })
            setTodo(newTodoList);
            renderTodos(newTodoList);
        }

        renderTodos(todo);
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    </head>
</body>

</html>